name: Run Python script

on: 
  workflow_dispatch:

jobs:
  run_script:
    runs-on: ubuntu-latest
    permissions:
      issues: write

    steps:
      - uses: actions/checkout@v3
        with:
          submodules: 'recursive'

      - name: Set up Python
        uses: actions/setup-python@v3
        with:
          python-version: 3.8

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install yfinance pandas numpy matplotlib ipython yfinance

      #- name: Run script
      #  run: python ${{ github.workspace }}/Market_Analysis_App/main.py

      - name: Auto commit changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: Automated Change
          file_pattern: '*'
          commit_user_name: gilbertycc
          commit_user_email: gilbertycc@gmail.com
          commit_author: BOT <gilbertycc@gmail.com>

      - name: Push changes
        uses: actions/github-script@v5
        with:
          script: |
            const { context, GitHub } = require('@actions/github');
            const { owner, repo } = context.repo;
            const gitHub = new GitHub(process.env.GITHUB_TOKEN);
            gitHub.repos.createOrUpdateFileContents({
              owner,
              repo,
              path: '${{ github.workspace }}/docs/index.html',
              message: 'Add index.html',
              content: Buffer.from('index.html').toString('base64'),
              sha: context.payload.before,
              branch: context.payload.ref.replace('refs/heads/', ''),
            })
          token: ${{ secrets.S1 }}
